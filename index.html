
<!DOCTYPE html>
<meta charset="utf-8">
<body onload="init();">
    <div class="uk-container">
        <h1 class="uk-heading-divider">Linija</h1>
        <ul uk-tab uk-switcher>
            <li class="uk-active"><a href="#">Pregled linije</a></li>
            <li><a href="#">Podrobnosti</a></li>
            <li><a href="#">Alarmi</a></li>
            <li><a href="#">Recepti</a></li>
        </ul>

        <ul class="uk-switcher uk-margin">
            <li>
                <form>
                    <fieldset class="uk-fieldset">
                        <span >Režim delovanja:</span>
                        <span id="rezimDelovanja">

                        </span>
                    </fieldset>
                </form>
                <div>
                    <canvas id="demoCanvas" width="2000" height="2000"></canvas>

                </div>
            </li>
            <li>
                Podrobnosti
            </li>
            <li>
                Alarmi
            </li>
            <li>
                Recepti
            </li>
        </ul>
    </div>
</body>
<!-- UIkit CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.42/css/uikit.min.css" />

<!-- UIkit JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.42/js/uikit.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.42/js/uikit-icons.min.js"></script>
<script src='./node_modules/animejs/anime.min.js'></script>
<script src="javascript/jquery.min.js"></script>

<div id="field"></div>
<div id="content"></div>
<div id="info"></div>
<script src='/socket.io/socket.io.js'></script>
<script src="https://code.createjs.com/tweenjs-0.6.2.min.js"></script>
<script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>

<script>

    obdelovanci = [];
    class Obdelovanec {
        constructor(id, recept, lokacija, graphics) {
            this.id = id;
            this.recept = recept;
            this.lokacija = lokacija;
            this.graphics = graphics;
        }
    }
    var id_counter = 0;

   // var circle = new createjs.Shape();
    var bat1 = new createjs.Shape();
    var miza = new createjs.Shape();
    var stiskalnica = new createjs.Shape();
    var bat2 = new createjs.Shape();
    var trak = new createjs.Shape();

    var stage;
    function init() {

        createjs.MotionGuidePlugin.install();
        stage = new createjs.Stage("demoCanvas");
        bat1.graphics.beginFill("grey").drawRoundRect (0, 0, 100, 30, 10);
        bat1.x = 0;
        bat1.y = 185;
        stage.addChild(bat1);

        miza.graphics.beginFill("grey").drawCircle(0, 0, 150);
        miza.x = 350;
        miza.y = 200;
        miza_notranjost = new createjs.Shape();
        miza_notranjost.graphics.beginFill("white").drawCircle(350, 200, 50);   
        stage.addChild(miza);
        stage.addChild(miza_notranjost);

        stiskalnica.graphics.beginFill("DimGrey").drawCircle(0,0,30);
        stiskalnica.x = 350;
        stiskalnica.y = 100;
        stiskalnica.shadow = new createjs.Shadow("#000000", 5, 5, 10);
        stage.addChild(stiskalnica);

        bat2.graphics.beginFill("black").drawRoundRect (0, 0, 100, 30, 10);
        bat2.x = 400;
        bat2.y = 185;
        stage.addChild(bat2);

        trak.graphics.beginFill("grey").drawRect(0,0,100,400)
        trak.x = 500;
        trak.y = 150;
        stage.addChild(trak);

        var path = new createjs.Shape();
        path.graphics.beginStroke("#ff00ff").moveTo(250,200).curveTo(250,100,350,100)
        stage.addChild(path);

        path = new createjs.Shape();
        path.graphics.beginStroke("#ff00ff").moveTo(350,100).curveTo(450,100, 450,200)
        stage.addChild(path);
        createjs.Ticker.setFPS(60);


        createjs.Ticker.addEventListener("tick", stage);
    }

    var messages = [];
    var socket = io.connect('http://localhost:3700');
    var rezimDelovanja = document.getElementById("rezimDelovanja");
    socket.on('rezimDelovanja', function (data) {
        //SPREMEMBA KLJUČA
        if(data.nodeId =="ns=4;s=Kljuc"){
            if(!data.value){
                rezimDelovanja.innerHTML = "<span class='uk-label uk-label-success'>Avtomatski</span>"
            }else{
                rezimDelovanja.innerHTML = "<span class='uk-label uk-label-warning'>Ročni</span>"

            }
        }
        //SPREMEMBA NA VHODU
        if(data.nodeId == "ns=4;s=Podatki_DB_lokacija1_zasedenost"){
            if(data.value){
                var obdelovanec_graphics = new createjs.Shape();
                obdelovanec_graphics.graphics.beginFill("DeepSkyBlue").drawCircle(0, 0, 50);
                obdelovanec_graphics.x = 150;
                obdelovanec_graphics.y = 200;
                var obdelovanec = new Obdelovanec(id_counter, 0, 1, obdelovanec_graphics);
                obdelovanci.push(obdelovanec);
                id_counter++;
                stage.addChild(obdelovanec.graphics);
                //NASTAVI Z-INDEX (OBDELOVANEC POD STISKALNICO IN BATOM2)
                stage.setChildIndex(stiskalnica, stage.getNumChildren()-1);
                stage.setChildIndex(bat2, stage.getNumChildren()-1);
            }else{
                //PREMAKNE OBDELOVANEC IZ LOKACIJE 1 NA 2 (ČE OBSTAJA NA LOKACIJI 1)
                /*obdelovanci.forEach(obd => {
                    if(obd.lokacija == 1){
                        var obd_graphics = obd.graphics;
                        createjs.Tween.get(obd_graphics)
                            .to({ x: 250 }, 200, createjs.Ease.getPowInOut(4));
                    }
                });*/
            }
        }     
        //SPREMEMBA NA LOKACIJI 2 (NI)
       /* if(data.nodeId == "ns=4;s=Podatki_DB_lokacija2_zasedenost"){
            if(data.value){
                obdelovanci.forEach(obd => {
                    if(obd.lokacija == 1){
                        var obd_graphics = obd.graphics;
                        createjs.Tween.get(obd_graphics)
                            .to({ x: 250 }, 200, createjs.Ease.getPowInOut(4));
                    }
                });
            }else{

            }
        }     */
        //SPREMEMBA BAT 1
        if(data.nodeId == "ns=4;s=Bat_A_naprej"){
            if(data.value){
                //PREMAKNI BAT 1
                createjs.Tween.get(bat1)
                    .to({ x: 100 }, 200, createjs.Ease.getPowInOut(4));
                //PREMAKNE OBDELOVANEC IZ LOKACIJE 1 NA 2 (ČE OBSTAJA NA LOKACIJI 1)
                obdelovanci.forEach(obd => {
                    if(obd.lokacija == 1){
                        var obd_graphics = obd.graphics;
                        createjs.Tween.get(obd_graphics)
                            .to({ x: 250 }, 200, createjs.Ease.getPowInOut(4));
                        obd.lokacija = obd.lokacija + 1;
                    }
                });    
            }else{
                createjs.Tween.get(bat1)
                    .to({ x: 0 }, 200, createjs.Ease.getPowInOut(4));
            }
        }
        //OBRAT MIZE
        if(data.nodeId == "ns=4;s=Miza_premik"){
            if(data.value){
                //PREMAKNE OBDELOVANEC IZ LOKACIJE 2 NA 3 (ČE OBSTAJA NA LOKACIJI 1)
                obdelovanci.forEach(obd => {               
                    if(obd.lokacija == 3){
                        var obd_graphics = obd.graphics;
                        createjs.Tween.get(obd_graphics).to({guide:{ path:[350,100,450,100, 450,200] }},3000);
                        obd.lokacija = obd.lokacija + 1;
                    }
                    if(obd.lokacija == 2){
                        var obd_graphics = obd.graphics;
                        createjs.Tween.get(obd_graphics).to({guide:{ path:[250,200, 250,100,350,100] }},3000);
                        obd.lokacija = obd.lokacija + 1;
                    }
                });    
            }else{
                createjs.Tween.get(bat1)
                    .to({ x: 0 }, 200, createjs.Ease.getPowInOut(4));
            }
        }

        //STISK
        if(data.nodeId == "ns=4;s=Stiskalnica_pritisk"){
            if(data.value){
                stiskalnica.graphics.clear().beginFill("black").drawCircle(0,0,30);
                stiskalnica.shadow = null;
            }else{
                stiskalnica.graphics.clear().beginFill("DimGrey").drawCircle(0,0,30);
                stiskalnica.shadow = new createjs.Shadow("#000000", 5, 5, 10);
            }
        }
        //SPREMEMBA BAT 2
        if(data.nodeId == "ns=4;s=Bat_B_naprej"){
            if(data.value){
                //PREMAKNI BAT 1
                createjs.Tween.get(bat2)
                    .to({ x: 500 }, 200, createjs.Ease.getPowInOut(4));
                //PREMAKNE OBDELOVANEC IZ LOKACIJE 4 NA 5 (ČE OBSTAJA NA LOKACIJI 4)
                obdelovanci.forEach(obd => {
                    if(obd.lokacija == 4){
                        var obd_graphics = obd.graphics;
                        createjs.Tween.get(obd_graphics)
                            .to({ x: 550 }, 200, createjs.Ease.getPowInOut(4));
                        obd.lokacija = obd.lokacija + 1;
                    }
                });    
            }else{
                createjs.Tween.get(bat2)
                    .to({ x: 400 }, 200, createjs.Ease.getPowInOut(4));
            }
        }

        //SPREMEMBA TRAK
        if(data.nodeId == "ns=4;s=Trak_premik"){
            if(data.value){
                //PREMAKNE OBDELOVANEC IZ LOKACIJE 5 NA 6 (ČE OBSTAJA NA LOKACIJI 5)
                obdelovanci.forEach(obd => {
                    //KONEC - ODSTRANI KOS
                    if(obd.lokacija == 6){
                       // TODO: remove object
                       // var obd_graphics = obd.graphics;
                       // obd_graphics.clear();
                    }
                    if(obd.lokacija == 5){
                        var obd_graphics = obd.graphics;
                        createjs.Tween.get(obd_graphics)
                            .to({ y: 500 }, 2000, createjs.Ease.getPowInOut(4));
                        obd.lokacija = obd.lokacija + 1;
                    }
                });    
            }else{

            }
        }
    });







</script>

<style>
 
</style>



